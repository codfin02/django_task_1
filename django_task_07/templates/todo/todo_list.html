{% extends 'todo/base.html' %}
{% block content %}
<div class="mt-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    {% if not request.user.is_superuser %}
      <h1>{{ request.user.username }}'s Todo List</h1>
    {% else %}
      <h1>All To Do List (By. Admin)</h1>
    {% endif %}
    <button class="btn btn-success" onclick="location.href='{% url 'cbv_todo_create' %}'">생성하기</button>
  </div>

  <form method="GET" class="mb-3">
    <div class="input-group">
      <input type="text" class="form-control" placeholder="제목 또는 내용을 입력하세요." name="q" value="{% if request.GET.q %}{{ request.GET.q }}{% endif %}">
      <button class="btn btn-primary" type="submit">Search</button>
    </div>
  </form>

  <ul class="list-unstyled">
    {% for todo in page_obj.object_list %}
      <li class="py-2 px-2 mb-2 bg-light rounded d-flex align-items-center" style="gap:12px;">
        <img class="img-thumbnail" src="{{ todo.thumbnail.url }}" alt="썸네일이미지" style="width: 80px; height: 80px; object-fit: contain;">
        <a href="{% url 'cbv_todo_info' todo.id %}">[{{ todo.user.username }}] {{ todo.title }}</a>
        {% if todo.is_completed %}<span class="badge bg-success ms-2">Completed</span>{% endif %}
      </li>
    {% empty %}
      <li class="text-muted">등록된 할 일이 없습니다.</li>
    {% endfor %}
  </ul>

  {% include 'todo/pagination.html' %}
</div>
{% endblock %}

